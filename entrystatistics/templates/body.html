{% if graph %}
  <script src="https://cdn.plot.ly/plotly-latest.min.js" type="text/javascript"></script>
  <script src="https://code.jquery.com/jquery-2.2.4.js" integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI=" crossorigin="anonymous"></script>
{% endif %}

<table>
{% for countLabel,countNum in statistics.counts %}
  <tr>
    <td style="padding-right: 10px;"><b>{{ countLabel|replace({'-':' '})|title }}</b></td>
    <td style="padding-left: 10px;">{{ countNum }}</td>
  </tr>
{% endfor %}
</table>

<ul id="#dates" style="display: none;">
  {% for key, value in statistics.data %}
    <li class="date" data-timestamp="{{ key|raw }}" data-count="{{ value }}">{{key}}: {{value}}</li>
  {% endfor %}
</ul>

{% if graph %}
  <div id="graph"></div>

  <script type="text/javascript">

    $(document).ready(function() {

      /**
       * Adapted from https://gist.github.com/chrisjhoughton/7890303
       * Waits for selector element to exist before applying callback
       */
      var waitForEl = function(selector, callback) {
        if ($(selector).length) {
          callback();
        } else {
          setTimeout(function() {
            waitForEl(selector, callback);
          }, 100);
        }
      };

      waitForEl('li.date', function() {
        var xVals = [];
        var yVals = [];

        $.each($('li.date'), function(index, dateLi) {
          xVals.push($(dateLi).data('timestamp'));
          yVals.push($(dateLi).data('count'));
        });

        var data = [
          {
            x: xVals,
            y: yVals,
            type: 'bar',
          }
        ];

        var layout = {
          "xaxis": {
            "type": "date",
          }
        };

        Plotly.newPlot('graph', data, layout);
      });

    });
  </script>
{% endif %}
